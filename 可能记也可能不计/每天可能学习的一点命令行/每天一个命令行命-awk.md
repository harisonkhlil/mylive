# æ¯å¤©ä¸€ä¸ªå‘½ä»¤è¡Œå‘½-awk

## Description

ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªæ–‡æœ¬å’Œæ•°æ®å¤„ç†å·¥å…·,ä¼˜åŠ¿æ˜¯å¯ä»¥å¤„ç†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–‡ä»¶æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å’Œæ­£åˆ™è¡¨è¾¾å¼,ä¸€èˆ¬ç”¨ä½œè„šæœ¬,å’Œ C è¯­è¨€æœ‰ä¸€å®šçš„ç›¸é€š.

## Syntax

```bash
awk [option] 'script' var=value files
awk [option] -f scriptfile var = value files
```

## Common selection

- `-f fs` fs æŒ‡å®šè¾“å…¥åˆ†éš”ç¬¦, fs å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ `-F` é»˜è®¤æ˜¯åˆ¶è¡¨ç¬¦æˆ–è€…è¿ç»­çš„ç©ºæ ¼
- ``-v var=value` é™„å€¼ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰å˜é‡å°†å¤–éƒ¨ variable ä¼ é€’ç»™ awk
- `-f scripfile` ä»è„šæœ¬æ–‡ä»¶è¯»å– awk å‘½ä»¤
- `-m [fr] var` ä¸çŸ¥é“ç®—å•¦

## Specific usage

### Patten

1. /Regular expression/: æ­£åˆ™è¡¨è¾¾å¼
2. å…³ç³»è¡¨è¾¾å¼
3. æ¨¡å¼åŒ¹é… æ¯”å¦‚éšä¾¿è¾“å…¥çš„ asdfghj æˆ–è€… â€˜asdfghjâ€™ éƒ½è¡Œ
4. BEGIN STATEMENT,PATTEN STATEMENT BLOCK, END STATEMENT BLOCK

### Operation

- varriable and array value
- input command
- Control flow statement
- Build-in functions

## Instance

awk åŸºæœ¬ç»“æ„:

```bash
awk 'BEGIN {print "start"} patten{ commands } END{ print "end" }' file
```

<!--æˆ‘çš„è¯„ä»·æ˜¯,çœŸåŸºå°”çƒ¦,æˆ‘ä¼°è®¡è¿˜éœ€è¦å­¦ä¹  bash è¯­å¥-->

### The operating principle

å°±æŒ‰ç…§ä¸Šé¢çš„ code block å§

- ç¬¬ä¸€æ­¥ï¼šæ‰§è¡Œ`BEGIN{ commands }`è¯­å¥å—ä¸­çš„è¯­å¥ï¼›
- ç¬¬äºŒæ­¥ï¼šä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥(stdin)è¯»å–ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œ`pattern{ commands }`è¯­å¥å—ï¼Œå®ƒé€è¡Œæ‰«ææ–‡ä»¶ï¼Œä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ–‡ä»¶å…¨éƒ¨è¢«è¯»å–å®Œæ¯•ã€‚
- ç¬¬ä¸‰æ­¥ï¼šå½“è¯»è‡³è¾“å…¥æµæœ«å°¾æ—¶ï¼Œæ‰§è¡Œ`END{ commands }`è¯­å¥å—ã€‚

**BEGINè¯­å¥å—** åœ¨awkå¼€å§‹ä»è¾“å…¥æµä¸­è¯»å–è¡Œ **ä¹‹å‰** è¢«æ‰§è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„è¯­å¥å—ï¼Œæ¯”å¦‚å˜é‡åˆå§‹åŒ–ã€æ‰“å°è¾“å‡ºè¡¨æ ¼çš„è¡¨å¤´ç­‰è¯­å¥é€šå¸¸å¯ä»¥å†™åœ¨BEGINè¯­å¥å—ä¸­ã€‚

**ENDè¯­å¥å—** åœ¨awkä»è¾“å…¥æµä¸­è¯»å–å®Œæ‰€æœ‰çš„è¡Œ **ä¹‹å** å³è¢«æ‰§è¡Œï¼Œæ¯”å¦‚æ‰“å°æ‰€æœ‰è¡Œçš„åˆ†æç»“æœè¿™ç±»ä¿¡æ¯æ±‡æ€»éƒ½æ˜¯åœ¨ENDè¯­å¥å—ä¸­å®Œæˆï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰è¯­å¥å—ã€‚

**patternè¯­å¥å—** ä¸­çš„é€šç”¨å‘½ä»¤æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå®ƒä¹Ÿæ˜¯å¯é€‰çš„ã€‚å¦‚æœæ²¡æœ‰æä¾›patternè¯­å¥å—ï¼Œåˆ™é»˜è®¤æ‰§è¡Œ`{ print }`ï¼Œå³æ‰“å°æ¯ä¸€ä¸ªè¯»å–åˆ°çš„è¡Œï¼Œawkè¯»å–çš„æ¯ä¸€è¡Œéƒ½ä¼šæ‰§è¡Œè¯¥è¯­å¥å—ã€‚

Sample:

```shell
$ awk 'BEGIN{print "start"; i=0 } { i++; print } END{ print i; print "END" }' init.lua

# input 
start
vim.defer_fn(function()
  pcall(require, "impatient")
end, 0)

require "core"
require "core.options"

-- setup packer + plugins
local fn = vim.fn
local install_path = fn.stdpath "data" .. "/site/pack/packer/opt/packer.nvim"

if fn.empty(fn.glob(install_path)) > 0 then
  vim.api.nvim_set_hl(0, "NormalFloat", { bg = "#1e222a" })
  print "Cloning packer .."
  fn.system { "git", "clone", "--depth", "1", "https://github.com/wbthomason/packer.nvim", install_path }

  -- install plugins + compile their configs
  vim.cmd "packadd packer.nvim"
  require "plugins"
  vim.cmd "PackerSync"

  -- install binaries from mason.nvim & tsparsers
  vim.api.nvim_create_autocmd("User", {
    pattern = "PackerComplete",
    callback = function()
      vim.cmd "bw | silent! MasonInstallAll" -- close packer window
      require("packer").loader "nvim-treesitter"
    end,
  })
end

pcall(require, "custom")

require("core.utils").load_mappings()
34
END
```

å½“ä½¿ç”¨ä¸å¸¦å‚æ•°çš„`print`æ—¶ï¼Œå®ƒå°±æ‰“å°å½“å‰è¡Œï¼Œå½“`print`çš„å‚æ•°æ˜¯ä»¥é€—å·è¿›è¡Œåˆ†éš”æ—¶ï¼Œæ‰“å°æ—¶åˆ™ä»¥ç©ºæ ¼ä½œä¸ºå®šç•Œç¬¦ã€‚åœ¨awkçš„printè¯­å¥å—ä¸­åŒå¼•å·æ˜¯è¢«å½“ä½œæ‹¼æ¥ç¬¦ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š

```shell
echo | awk '{ var1 = "v1"; var2 = "v2"; var3 = "v3"; print var1, var2, var3}'

# ---
v1 v2 v3
```

åŸºæœ¬æƒ…å†µå­¦åˆ°è¿™é‡Œå•¦,ä¸‹é¢éƒ½æ˜¯å¤åˆ¶çš„å–µğŸ˜

----

## å†…ç½®å˜é‡

è½¬ä¹‰åºåˆ—

```txt
\\ \è‡ªèº«
\$ è½¬ä¹‰$
\t åˆ¶è¡¨ç¬¦
\b é€€æ ¼ç¬¦
\r å›è½¦ç¬¦
\n æ¢è¡Œç¬¦
\c å–æ¶ˆæ¢è¡Œ
```

**ç¤ºä¾‹**

```shell
echo -e "line1 f2 f3\nline2 f4 f5\nline3 f6 f7" | awk '{print "Line No:"NR", No of fields:"NF, "$0="$0, "$1="$1, "$2="$2, "$3="$3}' 
Line No:1, No of fields:3 $0=line1 f2 f3 $1=line1 $2=f2 $3=f3
Line No:2, No of fields:3 $0=line2 f4 f5 $1=line2 $2=f4 $3=f5
Line No:3, No of fields:3 $0=line3 f6 f7 $1=line3 $2=f6 $3=f7
```

ä½¿ç”¨`print $NF`å¯ä»¥æ‰“å°å‡ºä¸€è¡Œä¸­çš„æœ€åä¸€ä¸ªå­—æ®µï¼Œä½¿ç”¨`$(NF-1)`åˆ™æ˜¯æ‰“å°å€’æ•°ç¬¬äºŒä¸ªå­—æ®µï¼Œå…¶ä»–ä»¥æ­¤ç±»æ¨ï¼š

```shell
echo -e "line1 f2 f3\n line2 f4 f5" | awk '{print $NF}'
f3
f5
echo -e "line1 f2 f3\n line2 f4 f5" | awk '{print $(NF-1)}'
f2
f4
```

æ‰“å°æ¯ä¸€è¡Œçš„ç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå­—æ®µï¼š

```shell
awk '{ print $2,$3 }' filename
```

ç»Ÿè®¡æ–‡ä»¶ä¸­çš„è¡Œæ•°ï¼š

```shell
awk 'END{ print NR }' filename
```

ä»¥ä¸Šå‘½ä»¤åªä½¿ç”¨äº†ENDè¯­å¥å—ï¼Œåœ¨è¯»å…¥æ¯ä¸€è¡Œçš„æ—¶ï¼Œawkä¼šå°†NRæ›´æ–°ä¸ºå¯¹åº”çš„è¡Œå·ï¼Œå½“åˆ°è¾¾æœ€åä¸€è¡ŒNRçš„å€¼å°±æ˜¯æœ€åä¸€è¡Œçš„è¡Œå·ï¼Œæ‰€ä»¥ENDè¯­å¥å—ä¸­çš„NRå°±æ˜¯æ–‡ä»¶çš„è¡Œæ•°ã€‚

ä¸€ä¸ªæ¯ä¸€è¡Œä¸­ç¬¬ä¸€ä¸ªå­—æ®µå€¼ç´¯åŠ çš„ä¾‹å­ï¼š

```shell
seq 5 | awk 'BEGIN{ sum=0; print "æ€»å’Œï¼š" } { print $1"+"; sum+=$1 } END{ print "ç­‰äº"; print sum }' 
æ€»å’Œï¼š
1+
2+
3+
4+
5+
ç­‰äº
15
```

## å°†å¤–éƒ¨å˜é‡å€¼ä¼ é€’ç»™awk

å€ŸåŠ© **`-v`é€‰é¡¹** ï¼Œå¯ä»¥å°†å¤–éƒ¨å€¼ï¼ˆå¹¶éæ¥è‡ªstdinï¼‰ä¼ é€’ç»™awkï¼š

```shell
VAR=10000
echo | awk -v VARIABLE=$VAR '{ print VARIABLE }'
```

å¦ä¸€ç§ä¼ é€’å¤–éƒ¨å˜é‡æ–¹æ³•ï¼š

```shell
var1="aaa"
var2="bbb"
echo | awk '{ print v1,v2 }' v1=$var1 v2=$var2
```

å½“è¾“å…¥æ¥è‡ªäºæ–‡ä»¶æ—¶ä½¿ç”¨ï¼š

```shell
awk '{ print v1,v2 }' v1=$var1 v2=$var2 filename
```

ä»¥ä¸Šæ–¹æ³•ä¸­ï¼Œå˜é‡ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ä½œä¸ºawkçš„å‘½ä»¤è¡Œå‚æ•°è·Ÿéšåœ¨BEGINã€{}å’ŒENDè¯­å¥å—ä¹‹åã€‚

### Find prosess pid

```shell
netstat -antup | grep 7770 | awk '{ print $NF NR}' | awk '{ print $1}'
```

## awkè¿ç®—ä¸åˆ¤æ–­

ä½œä¸ºä¸€ç§ç¨‹åºè®¾è®¡è¯­è¨€æ‰€åº”å…·æœ‰çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œawkæ”¯æŒå¤šç§è¿ç®—ï¼Œè¿™äº›è¿ç®—ä¸Cè¯­è¨€æä¾›çš„åŸºæœ¬ç›¸åŒã€‚awkè¿˜æä¾›äº†ä¸€ç³»åˆ—å†…ç½®çš„è¿ç®—å‡½æ•°ï¼ˆå¦‚logã€sqrã€cosã€sinç­‰ï¼‰å’Œä¸€äº›ç”¨äºå¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼ˆè¿ç®—ï¼‰çš„å‡½æ•°ï¼ˆå¦‚lengthã€substrç­‰ç­‰ï¼‰ã€‚è¿™äº›å‡½æ•°çš„å¼•ç”¨å¤§å¤§çš„æé«˜äº†awkçš„è¿ç®—åŠŸèƒ½ã€‚ä½œä¸ºå¯¹æ¡ä»¶è½¬ç§»æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œå…³ç³»åˆ¤æ–­æ˜¯æ¯ç§ç¨‹åºè®¾è®¡è¯­è¨€éƒ½å…·å¤‡çš„åŠŸèƒ½ï¼Œawkä¹Ÿä¸ä¾‹å¤–ï¼Œawkä¸­å…è®¸è¿›è¡Œå¤šç§æµ‹è¯•ï¼Œä½œä¸ºæ ·å¼åŒ¹é…ï¼Œè¿˜æä¾›äº†æ¨¡å¼åŒ¹é…è¡¨è¾¾å¼~ï¼ˆåŒ¹é…ï¼‰å’Œ!~ï¼ˆä¸åŒ¹é…ï¼‰ã€‚ä½œä¸ºå¯¹æµ‹è¯•çš„ä¸€ç§æ‰©å……ï¼Œawkä¹Ÿæ”¯æŒç”¨é€»è¾‘è¿ç®—ç¬¦ã€‚

### ç®—æœ¯è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | æè¿°                       |
| ------ | -------------------------- |
| + -    | åŠ ï¼Œå‡                     |
| * / &  | ä¹˜ï¼Œé™¤ä¸æ±‚ä½™               |
| + - !  | ä¸€å…ƒåŠ ï¼Œå‡å’Œé€»è¾‘é         |
| ^ ***  | æ±‚å¹‚                       |
| ++ --  | å¢åŠ æˆ–å‡å°‘ï¼Œä½œä¸ºå‰ç¼€æˆ–åç¼€ |

ä¾‹ï¼š

```shell
awk 'BEGIN{a="b";print a++,++a;}'
0 2
```

æ³¨æ„ï¼šæ‰€æœ‰ç”¨ä½œç®—æœ¯è¿ç®—ç¬¦è¿›è¡Œæ“ä½œï¼Œæ“ä½œæ•°è‡ªåŠ¨è½¬ä¸ºæ•°å€¼ï¼Œæ‰€æœ‰éæ•°å€¼éƒ½å˜ä¸º0

### èµ‹å€¼è¿ç®—ç¬¦

| è¿ç®—ç¬¦                  | æè¿°     |
| ----------------------- | -------- |
| = += -= *= /= %= ^= **= | èµ‹å€¼è¯­å¥ |

ä¾‹ï¼š

```shell
a+=5; ç­‰ä»·äºï¼ša=a+5; å…¶å®ƒåŒç±»
```

### é€»è¾‘è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | æè¿°   |
| ------ | ------ |
| `||`   | é€»è¾‘æˆ– |
| &&     | é€»è¾‘ä¸ |

ä¾‹ï¼š

```shell
awk 'BEGIN{a=1;b=2;print (a>5 && b<=2),(a>5 || b<=2);}'
0 1
```

### æ­£åˆ™è¿ç®—ç¬¦

| è¿ç®—ç¬¦ | æè¿°                             |
| ------ | -------------------------------- |
| ~ !~   | åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼å’Œä¸åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ |

```
^ è¡Œé¦–
$ è¡Œå°¾
. é™¤äº†æ¢è¡Œç¬¦ä»¥å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦
* å‰å¯¼å­—ç¬¦çš„é›¶ä¸ªæˆ–å¤šä¸ª
.* æ‰€æœ‰å­—ç¬¦
[] å­—ç¬¦ç»„å†…çš„ä»»ä¸€å­—ç¬¦
[^]å¯¹å­—ç¬¦ç»„å†…çš„æ¯ä¸ªå­—ç¬¦å–å(ä¸åŒ¹é…å­—ç¬¦ç»„å†…çš„æ¯ä¸ªå­—ç¬¦)
^[^] éå­—ç¬¦ç»„å†…çš„å­—ç¬¦å¼€å¤´çš„è¡Œ
[a-z] å°å†™å­—æ¯
[A-Z] å¤§å†™å­—æ¯
[a-Z] å°å†™å’Œå¤§å†™å­—æ¯
[0-9] æ•°å­—
\< å•è¯å¤´å•è¯ä¸€èˆ¬ä»¥ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦åšåˆ†éš”,è¿ç»­çš„å­—ç¬¦ä¸²è¢«å½“åšå•è¯
\> å•è¯å°¾
```

> æ­£åˆ™éœ€è¦ç”¨ /æ­£åˆ™/ åŒ…å›´ä½

ä¾‹ï¼š

```shell
awk 'BEGIN{a="100testa";if(a ~ /^100*/){print "ok";}}'
ok
```

### å…³ç³»è¿ç®—ç¬¦

| è¿ç®—ç¬¦          | æè¿°       |
| --------------- | ---------- |
| < <= > >= != == | å…³ç³»è¿ç®—ç¬¦ |

ä¾‹ï¼š

```shell
awk 'BEGIN{a=11;if(a >= 9){print "ok";}}'
ok
```

æ³¨æ„ï¼š> < å¯ä»¥ä½œä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œä¹Ÿå¯ä»¥ç”¨ä½œæ•°å€¼æ¯”è¾ƒï¼Œå…³é”®çœ‹æ“ä½œæ•°å¦‚æœæ˜¯å­—ç¬¦ä¸²å°±ä¼šè½¬æ¢ä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒã€‚ä¸¤ä¸ªéƒ½ä¸ºæ•°å­—æ‰è½¬ä¸ºæ•°å€¼æ¯”è¾ƒã€‚å­—ç¬¦ä¸²æ¯”è¾ƒï¼šæŒ‰ç…§ASCIIç é¡ºåºæ¯”è¾ƒã€‚

### å…¶å®ƒè¿ç®—ç¬¦

| è¿ç®—ç¬¦ | æè¿°                 |
| ------ | -------------------- |
| $      | å­—æ®µå¼•ç”¨             |
| ç©ºæ ¼   | å­—ç¬¦ä¸²è¿æ¥ç¬¦         |
| ?:     | Cæ¡ä»¶è¡¨è¾¾å¼          |
| in     | æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŸé”®å€¼ |

ä¾‹ï¼š

```shell
awk 'BEGIN{a="b";print a=="b"?"ok":"err";}'
ok
awk 'BEGIN{a="b";arr[0]="b";arr[1]="c";print (a in arr);}'
0
awk 'BEGIN{a="b";arr[0]="b";arr["b"]="c";print (a in arr);}'
1
```

### è¿ç®—çº§ä¼˜å…ˆçº§è¡¨

!çº§åˆ«è¶Šé«˜è¶Šä¼˜å…ˆ
çº§åˆ«è¶Šé«˜è¶Šä¼˜å…ˆ

## awké«˜çº§è¾“å…¥è¾“å‡º

### è¯»å–ä¸‹ä¸€æ¡è®°å½•

awkä¸­`next`è¯­å¥ä½¿ç”¨ï¼šåœ¨å¾ªç¯é€è¡ŒåŒ¹é…ï¼Œå¦‚æœé‡åˆ°nextï¼Œå°±ä¼šè·³è¿‡å½“å‰è¡Œï¼Œç›´æ¥å¿½ç•¥ä¸‹é¢è¯­å¥ã€‚è€Œè¿›è¡Œä¸‹ä¸€è¡ŒåŒ¹é…ã€‚nextè¯­å¥ä¸€èˆ¬ç”¨äºå¤šè¡Œåˆå¹¶ï¼š

```shell
cat text.txt
a
b
c
d
e

awk 'NR%2==1{next}{print NR,$0;}' text.txt
2 b
4 d
```

å½“è®°å½•è¡Œå·é™¤ä»¥2ä½™1ï¼Œå°±è·³è¿‡å½“å‰è¡Œã€‚ä¸‹é¢çš„`print NR,$0`ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œç¨‹åºæœ‰å¼€å§‹åˆ¤æ–­`NR%2`å€¼ã€‚è¿™ä¸ªæ—¶å€™è®°å½•è¡Œå·æ˜¯`ï¼š2` ï¼Œå°±ä¼šæ‰§è¡Œä¸‹é¢è¯­å¥å—ï¼š`'print NR,$0'`

åˆ†æå‘ç°éœ€è¦å°†åŒ…å«æœ‰â€œwebâ€è¡Œè¿›è¡Œè·³è¿‡ï¼Œç„¶åéœ€è¦å°†å†…å®¹ä¸ä¸‹é¢è¡Œåˆå¹¶ä¸ºä¸€è¡Œï¼š

```shell
cat text.txt
web01[192.168.2.100]
httpd            ok
tomcat               ok
sendmail               ok
web02[192.168.2.101]
httpd            ok
postfix               ok
web03[192.168.2.102]
mysqld            ok
httpd               ok
0
awk '/^web/{T=$0;next;}{print T":"t,$0;}' text.txt
web01[192.168.2.100]:   httpd            ok
web01[192.168.2.100]:   tomcat               ok
web01[192.168.2.100]:   sendmail               ok
web02[192.168.2.101]:   httpd            ok
web02[192.168.2.101]:   postfix               ok
web03[192.168.2.102]:   mysqld            ok
web03[192.168.2.102]:   httpd               ok
```

### ç®€å•åœ°è¯»å–ä¸€æ¡è®°å½•

`awk getline`ç”¨æ³•ï¼šè¾“å‡ºé‡å®šå‘éœ€ç”¨åˆ°`getlineå‡½æ•°`ã€‚getlineä»æ ‡å‡†è¾“å…¥ã€ç®¡é“æˆ–è€…å½“å‰æ­£åœ¨å¤„ç†çš„æ–‡ä»¶ä¹‹å¤–çš„å…¶ä»–è¾“å…¥æ–‡ä»¶è·å¾—è¾“å…¥ã€‚å®ƒè´Ÿè´£ä»è¾“å…¥è·å¾—ä¸‹ä¸€è¡Œçš„å†…å®¹ï¼Œå¹¶ç»™NF,NRå’ŒFNRç­‰å†…å»ºå˜é‡èµ‹å€¼ã€‚å¦‚æœå¾—åˆ°ä¸€æ¡è®°å½•ï¼Œgetlineå‡½æ•°è¿”å›1ï¼Œå¦‚æœåˆ°è¾¾æ–‡ä»¶çš„æœ«å°¾å°±è¿”å›0ï¼Œå¦‚æœå‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼Œå°±è¿”å›-1ã€‚

getlineè¯­æ³•ï¼šgetline varï¼Œå˜é‡varåŒ…å«äº†ç‰¹å®šè¡Œçš„å†…å®¹ã€‚

awk getlineä»æ•´ä½“ä¸Šæ¥è¯´ï¼Œç”¨æ³•è¯´æ˜ï¼š

- **å½“å…¶å·¦å³æ— é‡å®šå‘ç¬¦`|`æˆ–`<`æ—¶ï¼š** getlineä½œç”¨äºå½“å‰æ–‡ä»¶ï¼Œè¯»å…¥å½“å‰æ–‡ä»¶çš„ç¬¬ä¸€è¡Œç»™å…¶åè·Ÿçš„å˜é‡`var`æˆ–`$0`ï¼ˆæ— å˜é‡ï¼‰ï¼Œåº”è¯¥æ³¨æ„åˆ°ï¼Œç”±äºawkåœ¨å¤„ç†getlineä¹‹å‰å·²ç»è¯»å…¥äº†ä¸€è¡Œï¼Œæ‰€ä»¥getlineå¾—åˆ°çš„è¿”å›ç»“æœæ˜¯éš”è¡Œçš„ã€‚
- **å½“å…¶å·¦å³æœ‰é‡å®šå‘ç¬¦`|`æˆ–`<`æ—¶ï¼š** getlineåˆ™ä½œç”¨äºå®šå‘è¾“å…¥æ–‡ä»¶ï¼Œç”±äºè¯¥æ–‡ä»¶æ˜¯åˆšæ‰“å¼€ï¼Œå¹¶æ²¡æœ‰è¢«awkè¯»å…¥ä¸€è¡Œï¼Œåªæ˜¯getlineè¯»å…¥ï¼Œé‚£ä¹ˆgetlineè¿”å›çš„æ˜¯è¯¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼Œè€Œä¸æ˜¯éš”è¡Œã€‚

**ç¤ºä¾‹ï¼š**

æ‰§è¡Œlinuxçš„`date`å‘½ä»¤ï¼Œå¹¶é€šè¿‡ç®¡é“è¾“å‡ºç»™`getline`ï¼Œç„¶åå†æŠŠè¾“å‡ºèµ‹å€¼ç»™è‡ªå®šä¹‰å˜é‡outï¼Œå¹¶æ‰“å°å®ƒï¼š

```shell
awk 'BEGIN{ "date" | getline out; print out }' test
```

æ‰§è¡Œshellçš„dateå‘½ä»¤ï¼Œå¹¶é€šè¿‡ç®¡é“è¾“å‡ºç»™getlineï¼Œç„¶ågetlineä»ç®¡é“ä¸­è¯»å–å¹¶å°†è¾“å…¥èµ‹å€¼ç»™outï¼Œsplitå‡½æ•°æŠŠå˜é‡outè½¬åŒ–æˆæ•°ç»„monï¼Œç„¶åæ‰“å°æ•°ç»„monçš„ç¬¬äºŒä¸ªå…ƒç´ ï¼š

```shell
awk 'BEGIN{ "date" | getline out; split(out,mon); print mon[2] }' test
```

å‘½ä»¤lsçš„è¾“å‡ºä¼ é€’ç»™gelineä½œä¸ºè¾“å…¥ï¼Œå¾ªç¯ä½¿getlineä»lsçš„è¾“å‡ºä¸­è¯»å–ä¸€è¡Œï¼Œå¹¶æŠŠå®ƒæ‰“å°åˆ°å±å¹•ã€‚è¿™é‡Œæ²¡æœ‰è¾“å…¥æ–‡ä»¶ï¼Œå› ä¸ºBEGINå—åœ¨æ‰“å¼€è¾“å…¥æ–‡ä»¶å‰æ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥å¿½ç•¥è¾“å…¥æ–‡ä»¶ã€‚

```shell
awk 'BEGIN{ while( "ls" | getline) print }'
```

### å…³é—­æ–‡ä»¶

awkä¸­å…è®¸åœ¨ç¨‹åºä¸­å…³é—­ä¸€ä¸ªè¾“å…¥æˆ–è¾“å‡ºæ–‡ä»¶ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨awkçš„closeè¯­å¥ã€‚

```shell
close("filename")
```

filenameå¯ä»¥æ˜¯getlineæ‰“å¼€çš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯stdinï¼ŒåŒ…å«æ–‡ä»¶åçš„å˜é‡æˆ–è€…getlineä½¿ç”¨çš„ç¡®åˆ‡å‘½ä»¤ã€‚æˆ–ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ï¼Œå¯ä»¥æ˜¯stdoutï¼ŒåŒ…å«æ–‡ä»¶åçš„å˜é‡æˆ–ä½¿ç”¨ç®¡é“çš„ç¡®åˆ‡å‘½ä»¤ã€‚

### è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶

awkä¸­å…è®¸ç”¨å¦‚ä¸‹æ–¹å¼å°†ç»“æœè¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š

```shell
echo | awk '{printf("hello word!n") > "datafile"}'
# æˆ–
echo | awk '{printf("hello word!n") >> "datafile"}'
```

## è®¾ç½®å­—æ®µå®šç•Œç¬¦

é»˜è®¤çš„å­—æ®µå®šç•Œç¬¦æ˜¯ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨`-F "å®šç•Œç¬¦"` æ˜ç¡®æŒ‡å®šä¸€ä¸ªå®šç•Œç¬¦ï¼š

```shell
awk -F: '{ print $NF }' /etc/passwd
# æˆ–
awk 'BEGIN{ FS=":" } { print $NF }' /etc/passwd
```

åœ¨`BEGINè¯­å¥å—`ä¸­åˆ™å¯ä»¥ç”¨`OFS=â€œå®šç•Œç¬¦â€`è®¾ç½®è¾“å‡ºå­—æ®µçš„å®šç•Œç¬¦ã€‚

## æµç¨‹æ§åˆ¶è¯­å¥

åœ¨linux awkçš„whileã€do-whileå’Œforè¯­å¥ä¸­å…è®¸ä½¿ç”¨break,continueè¯­å¥æ¥æ§åˆ¶æµç¨‹èµ°å‘ï¼Œä¹Ÿå…è®¸ä½¿ç”¨exitè¿™æ ·çš„è¯­å¥æ¥é€€å‡ºã€‚breakä¸­æ–­å½“å‰æ­£åœ¨æ‰§è¡Œçš„å¾ªç¯å¹¶è·³åˆ°å¾ªç¯å¤–æ‰§è¡Œä¸‹ä¸€æ¡è¯­å¥ã€‚if æ˜¯æµç¨‹é€‰æ‹©ç”¨æ³•ã€‚awkä¸­ï¼Œæµç¨‹æ§åˆ¶è¯­å¥ï¼Œè¯­æ³•ç»“æ„ï¼Œä¸cè¯­è¨€ç±»å‹ã€‚æœ‰äº†è¿™äº›è¯­å¥ï¼Œå…¶å®å¾ˆå¤šshellç¨‹åºéƒ½å¯ä»¥äº¤ç»™awkï¼Œè€Œä¸”æ€§èƒ½æ˜¯éå¸¸å¿«çš„ã€‚ä¸‹é¢æ˜¯å„ä¸ªè¯­å¥ç”¨æ³•ã€‚

### æ¡ä»¶åˆ¤æ–­è¯­å¥

```shell
if(è¡¨è¾¾å¼)
  è¯­å¥1
else
  è¯­å¥2
```

æ ¼å¼ä¸­è¯­å¥1å¯ä»¥æ˜¯å¤šä¸ªè¯­å¥ï¼Œä¸ºäº†æ–¹ä¾¿åˆ¤æ–­å’Œé˜…è¯»ï¼Œæœ€å¥½å°†å¤šä¸ªè¯­å¥ç”¨{}æ‹¬èµ·æ¥ã€‚awkåˆ†æç»“æ„å…è®¸åµŒå¥—ï¼Œå…¶æ ¼å¼ä¸ºï¼š

```shell
if(è¡¨è¾¾å¼)
  {è¯­å¥1}
else if(è¡¨è¾¾å¼)
  {è¯­å¥2}
else
  {è¯­å¥3}
```

ç¤ºä¾‹ï¼š

```shell
awk 'BEGIN{
test=100;
if(test>90){
  print "very good";
  }
  else if(test>60){
    print "good";
  }
  else{
    print "no pass";
  }
}'

very good
```

æ¯æ¡å‘½ä»¤è¯­å¥åé¢å¯ä»¥ç”¨`;` **åˆ†å·** ç»“å°¾ã€‚

### å¾ªç¯è¯­å¥

### # whileè¯­å¥

```shell
while(è¡¨è¾¾å¼)
  {è¯­å¥}
```

ç¤ºä¾‹ï¼š

```shell
awk 'BEGIN{
test=100;
total=0;
while(i<=test){
  total+=i;
  i++;
}
print total;
}'
5050
```

### # forå¾ªç¯

forå¾ªç¯æœ‰ä¸¤ç§æ ¼å¼ï¼š

æ ¼å¼1ï¼š

```shell
for(å˜é‡ in æ•°ç»„)
  {è¯­å¥}
```

ç¤ºä¾‹ï¼š

```shell
awk 'BEGIN{
for(k in ENVIRON){
  print k"="ENVIRON[k];
}

}'
TERM=linux
G_BROKEN_FILENAMES=1
SHLVL=1
pwd=/root/text
...
logname=root
HOME=/root
SSH_CLIENT=192.168.1.21 53087 22
```

æ³¨ï¼šENVIRONæ˜¯awkå¸¸é‡ï¼Œæ˜¯å­å…¸å‹æ•°ç»„ã€‚

æ ¼å¼2ï¼š

```shell
for(å˜é‡;æ¡ä»¶;è¡¨è¾¾å¼)
  {è¯­å¥}
```

ç¤ºä¾‹ï¼š

```shell
awk 'BEGIN{
total=0;
for(i=0;i<=100;i++){
  total+=i;
}
print total;
}'
5050
```

### # doå¾ªç¯

```shell
do
{è¯­å¥} while(æ¡ä»¶)
```

ä¾‹å­ï¼š

```shell
awk 'BEGIN{ 
total=0;
i=0;
do {total+=i;i++;} while(i<=100)
  print total;
}'
5050
```

### å…¶ä»–è¯­å¥

- **break** å½“ break è¯­å¥ç”¨äº while æˆ– for è¯­å¥æ—¶ï¼Œå¯¼è‡´é€€å‡ºç¨‹åºå¾ªç¯ã€‚
- **continue** å½“ continue è¯­å¥ç”¨äº while æˆ– for è¯­å¥æ—¶ï¼Œä½¿ç¨‹åºå¾ªç¯ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªè¿­ä»£ã€‚
- **next** èƒ½èƒ½å¤Ÿå¯¼è‡´è¯»å…¥ä¸‹ä¸€ä¸ªè¾“å…¥è¡Œï¼Œå¹¶è¿”å›åˆ°è„šæœ¬çš„é¡¶éƒ¨ã€‚è¿™å¯ä»¥é¿å…å¯¹å½“å‰è¾“å…¥è¡Œæ‰§è¡Œå…¶ä»–çš„æ“ä½œè¿‡ç¨‹ã€‚
- **exit** è¯­å¥ä½¿ä¸»è¾“å…¥å¾ªç¯é€€å‡ºå¹¶å°†æ§åˆ¶è½¬ç§»åˆ°END,å¦‚æœENDå­˜åœ¨çš„è¯ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰ENDè§„åˆ™ï¼Œæˆ–åœ¨ENDä¸­åº”ç”¨exitè¯­å¥ï¼Œåˆ™ç»ˆæ­¢è„šæœ¬çš„æ‰§è¡Œã€‚

## æ•°ç»„åº”ç”¨

æ•°ç»„æ˜¯awkçš„çµé­‚ï¼Œå¤„ç†æ–‡æœ¬ä¸­æœ€ä¸èƒ½å°‘çš„å°±æ˜¯å®ƒçš„æ•°ç»„å¤„ç†ã€‚å› ä¸ºæ•°ç»„ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰å¯ä»¥æ˜¯æ•°å­—å’Œå­—ç¬¦ä¸²åœ¨awkä¸­æ•°ç»„å«åšå…³è”æ•°ç»„(associative arrays)ã€‚awk ä¸­çš„æ•°ç»„ä¸å¿…æå‰å£°æ˜ï¼Œä¹Ÿä¸å¿…å£°æ˜å¤§å°ã€‚æ•°ç»„å…ƒç´ ç”¨0æˆ–ç©ºå­—ç¬¦ä¸²æ¥åˆå§‹åŒ–ï¼Œè¿™æ ¹æ®ä¸Šä¸‹æ–‡è€Œå®šã€‚

### æ•°ç»„çš„å®šä¹‰

æ•°å­—åšæ•°ç»„ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰ï¼š

```shell
Array[1]="sun"
Array[2]="kai"
```

å­—ç¬¦ä¸²åšæ•°ç»„ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰ï¼š

```shell
Array["first"]="www"
Array"[last"]="name"
Array["birth"]="1987"
```

ä½¿ç”¨ä¸­`print Array[1]`ä¼šæ‰“å°å‡ºsunï¼›ä½¿ç”¨`print Array[2]`ä¼šæ‰“å°å‡ºkaiï¼›ä½¿ç”¨`print["birth"]`ä¼šå¾—åˆ°1987ã€‚

**è¯»å–æ•°ç»„çš„å€¼**

```shell
{ for(item in array) {print array[item]}; }       #è¾“å‡ºçš„é¡ºåºæ˜¯éšæœºçš„
{ for(i=1;i<=len;i++) {print array[i]}; }         #Lenæ˜¯æ•°ç»„çš„é•¿åº¦
```

### æ•°ç»„ç›¸å…³å‡½æ•°

**å¾—åˆ°æ•°ç»„é•¿åº¦ï¼š**

```shell
awk 'BEGIN{info="it is a test";lens=split(info,tA," ");print length(tA),lens;}'
4 4
```

lengthè¿”å›å­—ç¬¦ä¸²ä»¥åŠæ•°ç»„é•¿åº¦ï¼Œsplitè¿›è¡Œåˆ†å‰²å­—ç¬¦ä¸²ä¸ºæ•°ç»„ï¼Œä¹Ÿä¼šè¿”å›åˆ†å‰²å¾—åˆ°æ•°ç»„é•¿åº¦ã€‚

```shell
awk 'BEGIN{info="it is a test";split(info,tA," ");print asort(tA);}'
4
```

asortå¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œè¿”å›æ•°ç»„é•¿åº¦ã€‚

**è¾“å‡ºæ•°ç»„å†…å®¹ï¼ˆæ— åºï¼Œæœ‰åºè¾“å‡ºï¼‰ï¼š**

```shell
awk 'BEGIN{info="it is a test";split(info,tA," ");for(k in tA){print k,tA[k];}}'
4 test
1 it
2 is
3 a 
```

`forâ€¦in`è¾“å‡ºï¼Œå› ä¸ºæ•°ç»„æ˜¯å…³è”æ•°ç»„ï¼Œé»˜è®¤æ˜¯æ— åºçš„ã€‚æ‰€ä»¥é€šè¿‡`forâ€¦in`å¾—åˆ°æ˜¯æ— åºçš„æ•°ç»„ã€‚å¦‚æœéœ€è¦å¾—åˆ°æœ‰åºæ•°ç»„ï¼Œéœ€è¦é€šè¿‡ä¸‹æ ‡è·å¾—ã€‚

```shell
awk 'BEGIN{info="it is a test";tlen=split(info,tA," ");for(k=1;k<=tlen;k++){print k,tA[k];}}'
1 it
2 is
3 a
4 test
```

æ³¨æ„ï¼šæ•°ç»„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹ï¼Œä¸Cæ•°ç»„ä¸ä¸€æ ·ã€‚

**åˆ¤æ–­é”®å€¼å­˜åœ¨ä»¥åŠåˆ é™¤é”®å€¼ï¼š**

```shell
# é”™è¯¯çš„åˆ¤æ–­æ–¹æ³•ï¼š
awk 'BEGIN{tB["a"]="a1";tB["b"]="b1";if(tB["c"]!="1"){print "no found";};for(k in tB){print k,tB[k];}}' 
no found
a a1
b b1
c
```

ä»¥ä¸Šå‡ºç°å¥‡æ€ªé—®é¢˜ï¼Œ`tB[â€œcâ€]`æ²¡æœ‰å®šä¹‰ï¼Œä½†æ˜¯å¾ªç¯æ—¶å€™ï¼Œå‘ç°å·²ç»å­˜åœ¨è¯¥é”®å€¼ï¼Œå®ƒçš„å€¼ä¸ºç©ºï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œawkæ•°ç»„æ˜¯å…³è”æ•°ç»„ï¼Œåªè¦é€šè¿‡æ•°ç»„å¼•ç”¨å®ƒçš„keyï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»ºæ”¹åºåˆ—ã€‚

```shell
# æ­£ç¡®åˆ¤æ–­æ–¹æ³•ï¼š
awk 'BEGIN{tB["a"]="a1";tB["b"]="b1";if( "c" in tB){print "ok";};for(k in tB){print k,tB[k];}}'  
a a1
b b1
```

`if(key in array)`é€šè¿‡è¿™ç§æ–¹æ³•åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦åŒ…å«`key`é”®å€¼ã€‚

```shell
#åˆ é™¤é”®å€¼ï¼š
awk 'BEGIN{tB["a"]="a1";tB["b"]="b1";delete tB["a"];for(k in tB){print k,tB[k];}}'                     
b b1
```

`delete array[key]`å¯ä»¥åˆ é™¤ï¼Œå¯¹åº”æ•°ç»„`key`çš„ï¼Œåºåˆ—å€¼ã€‚

### äºŒç»´ã€å¤šç»´æ•°ç»„ä½¿ç”¨

awkçš„å¤šç»´æ•°ç»„åœ¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç»´æ•°ç»„ï¼Œæ›´ç¡®åˆ‡ä¸€ç‚¹ï¼Œawkåœ¨å­˜å‚¨ä¸Šå¹¶ä¸æ”¯æŒå¤šç»´æ•°ç»„ã€‚awkæä¾›äº†é€»è¾‘ä¸Šæ¨¡æ‹ŸäºŒç»´æ•°ç»„çš„è®¿é—®æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œ`array[2,4]=1`è¿™æ ·çš„è®¿é—®æ˜¯å…è®¸çš„ã€‚awkä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—ç¬¦ä¸²`SUBSEP(ï¿½34)`ä½œä¸ºåˆ†å‰²å­—æ®µï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå…³è”æ•°ç»„arrayå­˜å‚¨çš„é”®å€¼å®é™…ä¸Šæ˜¯2ï¿½344ã€‚

ç±»ä¼¼ä¸€ç»´æ•°ç»„çš„æˆå‘˜æµ‹è¯•ï¼Œå¤šç»´æ•°ç»„å¯ä»¥ä½¿ç”¨`if ( (i,j) in array)`è¿™æ ·çš„è¯­æ³•ï¼Œä½†æ˜¯ä¸‹æ ‡å¿…é¡»æ”¾ç½®åœ¨åœ†æ‹¬å·ä¸­ã€‚ç±»ä¼¼ä¸€ç»´æ•°ç»„çš„å¾ªç¯è®¿é—®ï¼Œå¤šç»´æ•°ç»„ä½¿ç”¨`for ( item in array )`è¿™æ ·çš„è¯­æ³•éå†æ•°ç»„ã€‚ä¸ä¸€ç»´æ•°ç»„ä¸åŒçš„æ˜¯ï¼Œå¤šç»´æ•°ç»„å¿…é¡»ä½¿ç”¨`split()`å‡½æ•°æ¥è®¿é—®å•ç‹¬çš„ä¸‹æ ‡åˆ†é‡ã€‚

```shell
awk 'BEGIN{
for(i=1;i<=9;i++){
  for(j=1;j<=9;j++){
    tarr[i,j]=i*j; print i,"*",j,"=",tarr[i,j];
  }
}
}'
1 * 1 = 1
1 * 2 = 2
1 * 3 = 3
1 * 4 = 4
1 * 5 = 5
1 * 6 = 6 
...
9 * 6 = 54
9 * 7 = 63
9 * 8 = 72
9 * 9 = 81
```

å¯ä»¥é€šè¿‡`array[k,k2]`å¼•ç”¨è·å¾—æ•°ç»„å†…å®¹ã€‚

å¦ä¸€ç§æ–¹æ³•ï¼š

```shell
awk 'BEGIN{
for(i=1;i<=9;i++){
  for(j=1;j<=9;j++){
    tarr[i,j]=i*j;
  }
}
for(m in tarr){
  split(m,tarr2,SUBSEP); print tarr2[1],"*",tarr2[2],"=",tarr[m];
}
}'
```

## å†…ç½®å‡½æ•°

awkå†…ç½®å‡½æ•°ï¼Œä¸»è¦åˆ†ä»¥ä¸‹3ç§ç±»ä¼¼ï¼šç®—æ•°å‡½æ•°ã€å­—ç¬¦ä¸²å‡½æ•°ã€å…¶å®ƒä¸€èˆ¬å‡½æ•°ã€æ—¶é—´å‡½æ•°ã€‚

### ç®—æœ¯å‡½æ•°

| æ ¼å¼            | æè¿°                                                         |
| --------------- | ------------------------------------------------------------ |
| atan2( y, x )   | è¿”å› y/x çš„åæ­£åˆ‡ã€‚                                          |
| cos( x )        | è¿”å› x çš„ä½™å¼¦ï¼›x æ˜¯å¼§åº¦ã€‚                                    |
| sin( x )        | è¿”å› x çš„æ­£å¼¦ï¼›x æ˜¯å¼§åº¦ã€‚                                    |
| exp( x )        | è¿”å› x å¹‚å‡½æ•°ã€‚                                              |
| log( x )        | è¿”å› x çš„è‡ªç„¶å¯¹æ•°ã€‚                                          |
| sqrt( x )       | è¿”å› x å¹³æ–¹æ ¹ã€‚                                              |
| int( x )        | è¿”å› x çš„æˆªæ–­è‡³æ•´æ•°çš„å€¼ã€‚                                    |
| rand( )         | è¿”å›ä»»æ„æ•°å­— nï¼Œå…¶ä¸­ 0 <= n < 1ã€‚                            |
| srand( [expr] ) | å°† rand å‡½æ•°çš„ç§å­å€¼è®¾ç½®ä¸º Expr å‚æ•°çš„å€¼ï¼Œæˆ–å¦‚æœçœç•¥ Expr å‚æ•°åˆ™ä½¿ç”¨æŸå¤©çš„æ—¶é—´ã€‚è¿”å›å…ˆå‰çš„ç§å­å€¼ã€‚ |

ä¸¾ä¾‹è¯´æ˜ï¼š

```shell
awk 'BEGIN{OFMT="%.3f";fs=sin(1);fe=exp(10);fl=log(10);fi=int(3.1415);print fs,fe,fl,fi;}'
0.841 22026.466 2.303 3
```

OFMT è®¾ç½®è¾“å‡ºæ•°æ®æ ¼å¼æ˜¯ä¿ç•™3ä½å°æ•°ã€‚

è·å¾—éšæœºæ•°ï¼š

```shell
awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
78
awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
31
awk 'BEGIN{srand();fr=int(100*rand());print fr;}'
41 
```

### å­—ç¬¦ä¸²å‡½æ•°

| æ ¼å¼                                | æè¿°                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| gsub( Ere, Repl, [ In ] )           | é™¤äº†æ­£åˆ™è¡¨è¾¾å¼æ‰€æœ‰å…·ä½“å€¼è¢«æ›¿ä»£è¿™ç‚¹ï¼Œå®ƒå’Œ sub å‡½æ•°å®Œå…¨ä¸€æ ·åœ°æ‰§è¡Œã€‚ |
| sub( Ere, Repl, [ In ] )            | ç”¨ Repl å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²æ›¿æ¢ In å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­çš„ç”± Ere å‚æ•°æŒ‡å®šçš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå…·ä½“å€¼ã€‚sub å‡½æ•°è¿”å›æ›¿æ¢çš„æ•°é‡ã€‚å‡ºç°åœ¨ Repl å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­çš„ &ï¼ˆå’Œç¬¦å·ï¼‰ç”± In å‚æ•°æŒ‡å®šçš„ä¸ Ere å‚æ•°çš„æŒ‡å®šçš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­—ç¬¦ä¸²æ›¿æ¢ã€‚å¦‚æœæœªæŒ‡å®š In å‚æ•°ï¼Œç¼ºçœå€¼æ˜¯æ•´ä¸ªè®°å½•ï¼ˆ$0 è®°å½•å˜é‡ï¼‰ã€‚ |
| index( String1, String2 )           | åœ¨ç”± String1 å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼ˆå…¶ä¸­æœ‰å‡ºç° String2 æŒ‡å®šçš„å‚æ•°ï¼‰ä¸­ï¼Œè¿”å›ä½ç½®ï¼Œä» 1 å¼€å§‹ç¼–å·ã€‚å¦‚æœ String2 å‚æ•°ä¸åœ¨ String1 å‚æ•°ä¸­å‡ºç°ï¼Œåˆ™è¿”å› 0ï¼ˆé›¶ï¼‰ã€‚ |
| length [(String)]                   | è¿”å› String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆå­—ç¬¦å½¢å¼ï¼‰ã€‚å¦‚æœæœªç»™å‡º String å‚æ•°ï¼Œåˆ™è¿”å›æ•´ä¸ªè®°å½•çš„é•¿åº¦ï¼ˆ$0 è®°å½•å˜é‡ï¼‰ã€‚ |
| blength [(String)]                  | è¿”å› String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚å¦‚æœæœªç»™å‡º String å‚æ•°ï¼Œåˆ™è¿”å›æ•´ä¸ªè®°å½•çš„é•¿åº¦ï¼ˆ$0 è®°å½•å˜é‡ï¼‰ã€‚ |
| substr( String, M, [ N ] )          | è¿”å›å…·æœ‰ N å‚æ•°æŒ‡å®šçš„å­—ç¬¦æ•°é‡å­ä¸²ã€‚å­ä¸²ä» String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²å–å¾—ï¼Œå…¶å­—ç¬¦ä»¥ M å‚æ•°æŒ‡å®šçš„ä½ç½®å¼€å§‹ã€‚M å‚æ•°æŒ‡å®šä¸ºå°† String å‚æ•°ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºç¼–å· 1ã€‚å¦‚æœæœªæŒ‡å®š N å‚æ•°ï¼Œåˆ™å­ä¸²çš„é•¿åº¦å°†æ˜¯ M å‚æ•°æŒ‡å®šçš„ä½ç½®åˆ° String å‚æ•°çš„æœ«å°¾ çš„é•¿åº¦ã€‚ |
| match( String, Ere )                | åœ¨ String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼ˆEre å‚æ•°æŒ‡å®šçš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼å‡ºç°åœ¨å…¶ä¸­ï¼‰ä¸­è¿”å›ä½ç½®ï¼ˆå­—ç¬¦å½¢å¼ï¼‰ï¼Œä» 1 å¼€å§‹ç¼–å·ï¼Œæˆ–å¦‚æœ Ere å‚æ•°ä¸å‡ºç°ï¼Œåˆ™è¿”å› 0ï¼ˆé›¶ï¼‰ã€‚RSTART ç‰¹æ®Šå˜é‡è®¾ç½®ä¸ºè¿”å›å€¼ã€‚RLENGTH ç‰¹æ®Šå˜é‡è®¾ç½®ä¸ºåŒ¹é…çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œæˆ–å¦‚æœæœªæ‰¾åˆ°ä»»ä½•åŒ¹é…ï¼Œåˆ™è®¾ç½®ä¸º -1ï¼ˆè´Ÿä¸€ï¼‰ã€‚ |
| split( String, A, [Ere] )           | å°† String å‚æ•°æŒ‡å®šçš„å‚æ•°åˆ†å‰²ä¸ºæ•°ç»„å…ƒç´  A[1], A[2], . . ., A[n]ï¼Œå¹¶è¿”å› n å˜é‡çš„å€¼ã€‚æ­¤åˆ†éš”å¯ä»¥é€šè¿‡ Ere å‚æ•°æŒ‡å®šçš„æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œï¼Œæˆ–ç”¨å½“å‰å­—æ®µåˆ†éš”ç¬¦ï¼ˆFS ç‰¹æ®Šå˜é‡ï¼‰æ¥è¿›è¡Œï¼ˆå¦‚æœæ²¡æœ‰ç»™å‡º Ere å‚æ•°ï¼‰ã€‚é™¤éä¸Šä¸‹æ–‡æŒ‡æ˜ç‰¹å®šçš„å…ƒç´ è¿˜åº”å…·æœ‰ä¸€ä¸ªæ•°å­—å€¼ï¼Œå¦åˆ™ A æ•°ç»„ä¸­çš„å…ƒç´ ç”¨å­—ç¬¦ä¸²å€¼æ¥åˆ›å»ºã€‚ |
| tolower( String )                   | è¿”å› String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå¤§å†™å­—ç¬¦å°†æ›´æ”¹ä¸ºå°å†™ã€‚å¤§å†™å’Œå°å†™çš„æ˜ å°„ç”±å½“å‰è¯­è¨€ç¯å¢ƒçš„ LC_CTYPE èŒƒç•´å®šä¹‰ã€‚ |
| toupper( String )                   | è¿”å› String å‚æ•°æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå°å†™å­—ç¬¦å°†æ›´æ”¹ä¸ºå¤§å†™ã€‚å¤§å†™å’Œå°å†™çš„æ˜ å°„ç”±å½“å‰è¯­è¨€ç¯å¢ƒçš„ LC_CTYPE èŒƒç•´å®šä¹‰ã€‚ |
| sprintf(Format, Expr, Expr, . . . ) | æ ¹æ® Format å‚æ•°æŒ‡å®šçš„ printf å­ä¾‹ç¨‹æ ¼å¼å­—ç¬¦ä¸²æ¥æ ¼å¼åŒ– Expr å‚æ•°æŒ‡å®šçš„è¡¨è¾¾å¼å¹¶è¿”å›æœ€åç”Ÿæˆçš„å­—ç¬¦ä¸²ã€‚ |

æ³¨ï¼šEreéƒ½å¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚

**gsub,subä½¿ç”¨**

```shell
awk 'BEGIN{info="this is a test2010test!";gsub(/[0-9]+/,"!",info);print info}'
this is a test!test!
```

åœ¨ infoä¸­æŸ¥æ‰¾æ»¡è¶³æ­£åˆ™è¡¨è¾¾å¼ï¼Œ`/[0-9]+/` ç”¨`â€â€`æ›¿æ¢ï¼Œå¹¶ä¸”æ›¿æ¢åçš„å€¼ï¼Œèµ‹å€¼ç»™info æœªç»™infoå€¼ï¼Œé»˜è®¤æ˜¯`$0`

**æŸ¥æ‰¾å­—ç¬¦ä¸²ï¼ˆindexä½¿ç”¨ï¼‰**

```shell
awk 'BEGIN{info="this is a test2010test!";print index(info,"test")?"ok":"no found";}'
ok
```

æœªæ‰¾åˆ°ï¼Œè¿”å›0

**æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æŸ¥æ‰¾(matchä½¿ç”¨ï¼‰**

```
awk 'BEGIN{info="this is a test2010test!";print match(info,/[0-9]+/)?"ok":"no found";}'
ok
```

**æˆªå–å­—ç¬¦ä¸²(substrä½¿ç”¨ï¼‰**

```shell
[wangsl@centos5 ~]$ awk 'BEGIN{info="this is a test2010test!";print substr(info,4,10);}'
s is a tes
```

ä»ç¬¬ 4ä¸ª å­—ç¬¦å¼€å§‹ï¼Œæˆªå–10ä¸ªé•¿åº¦å­—ç¬¦ä¸²

**å­—ç¬¦ä¸²åˆ†å‰²ï¼ˆsplitä½¿ç”¨ï¼‰**

```shell
awk 'BEGIN{info="this is a test";split(info,tA," ");print length(tA);for(k in tA){print k,tA[k];}}'
4
4 test
1 this
2 is
3 a
```

åˆ†å‰²infoï¼ŒåŠ¨æ€åˆ›å»ºæ•°ç»„tAï¼Œè¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€ï¼Œ`awk for â€¦in`å¾ªç¯ï¼Œæ˜¯ä¸€ä¸ªæ— åºçš„å¾ªç¯ã€‚ å¹¶ä¸æ˜¯ä»æ•°ç»„ä¸‹æ ‡1â€¦n ï¼Œå› æ­¤ä½¿ç”¨æ—¶å€™éœ€è¦æ³¨æ„ã€‚

**æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºï¼ˆsprintfä½¿ç”¨ï¼‰**

æ ¼å¼åŒ–å­—ç¬¦ä¸²æ ¼å¼ï¼š

å…¶ä¸­æ ¼å¼åŒ–å­—ç¬¦ä¸²åŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼šä¸€éƒ¨åˆ†æ˜¯æ­£å¸¸å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å°†æŒ‰åŸæ ·è¾“å‡º; å¦ä¸€éƒ¨åˆ†æ˜¯æ ¼å¼åŒ–è§„å®šå­—ç¬¦ï¼Œä»¥`"%"`å¼€å§‹ï¼Œåè·Ÿä¸€ä¸ªæˆ–å‡ ä¸ªè§„å®šå­—ç¬¦,ç”¨æ¥ç¡®å®šè¾“å‡ºå†…å®¹æ ¼å¼ã€‚

| æ ¼å¼ | æè¿°                     | æ ¼å¼ | æè¿°                          |
| ---- | ------------------------ | ---- | ----------------------------- |
| %d   | åè¿›åˆ¶æœ‰ç¬¦å·æ•´æ•°         | %u   | åè¿›åˆ¶æ— ç¬¦å·æ•´æ•°              |
| %f   | æµ®ç‚¹æ•°                   | %s   | å­—ç¬¦ä¸²                        |
| %c   | å•ä¸ªå­—ç¬¦                 | %p   | æŒ‡é’ˆçš„å€¼                      |
| %e   | æŒ‡æ•°å½¢å¼çš„æµ®ç‚¹æ•°         | %x   | %X æ— ç¬¦å·ä»¥åå…­è¿›åˆ¶è¡¨ç¤ºçš„æ•´æ•° |
| %o   | æ— ç¬¦å·ä»¥å…«è¿›åˆ¶è¡¨ç¤ºçš„æ•´æ•° | %g   | è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„è¡¨ç¤ºæ³•          |

```shell
awk 'BEGIN{n1=124.113;n2=-1.224;n3=1.2345; printf("%.2f,%.2u,%.2g,%X,%on",n1,n2,n3,n1,n1);}'
124.11,18446744073709551615,1.2,7C,174
```

### ä¸€èˆ¬å‡½æ•°

| æ ¼å¼                                | æè¿°                                                         |
| ----------------------------------- | ------------------------------------------------------------ |
| close( Expression )                 | ç”¨åŒä¸€ä¸ªå¸¦å­—ç¬¦ä¸²å€¼çš„ Expression å‚æ•°æ¥å…³é—­ç”± print æˆ– printf è¯­å¥æ‰“å¼€çš„æˆ–è°ƒç”¨ getline å‡½æ•°æ‰“å¼€çš„æ–‡ä»¶æˆ–ç®¡é“ã€‚å¦‚æœæ–‡ä»¶æˆ–ç®¡é“æˆåŠŸå…³é—­ï¼Œåˆ™è¿”å› 0ï¼›å…¶å®ƒæƒ…å†µä¸‹è¿”å›éé›¶å€¼ã€‚å¦‚æœæ‰“ç®—å†™ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ç¨ååœ¨åŒä¸€ä¸ªç¨‹åºä¸­è¯»å–æ–‡ä»¶ï¼Œåˆ™ close è¯­å¥æ˜¯å¿…éœ€çš„ã€‚ |
| system(command )                    | æ‰§è¡Œ Command å‚æ•°æŒ‡å®šçš„å‘½ä»¤ï¼Œå¹¶è¿”å›é€€å‡ºçŠ¶æ€ã€‚ç­‰åŒäº system å­ä¾‹ç¨‹ã€‚ |
| Expression `|` getline [ Variable ] | ä»æ¥è‡ª Expression å‚æ•°æŒ‡å®šçš„å‘½ä»¤çš„è¾“å‡ºä¸­é€šè¿‡ç®¡é“ä¼ é€çš„æµä¸­è¯»å–ä¸€ä¸ªè¾“å…¥è®°å½•ï¼Œå¹¶å°†è¯¥è®°å½•çš„å€¼æŒ‡å®šç»™ Variable å‚æ•°æŒ‡å®šçš„å˜é‡ã€‚å¦‚æœå½“å‰æœªæ‰“å¼€å°† Expression å‚æ•°çš„å€¼ä½œä¸ºå…¶å‘½ä»¤åç§°çš„æµï¼Œåˆ™åˆ›å»ºæµã€‚åˆ›å»ºçš„æµç­‰åŒäºè°ƒç”¨ popen å­ä¾‹ç¨‹ï¼Œæ­¤æ—¶ Command å‚æ•°å– Expression å‚æ•°çš„å€¼ä¸” Mode å‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªæ˜¯ r çš„å€¼ã€‚åªè¦æµä¿ç•™æ‰“å¼€ä¸” Expression å‚æ•°æ±‚å¾—åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å¯¹ getline å‡½æ•°çš„æ¯æ¬¡åç»­è°ƒç”¨è¯»å–å¦ä¸€ä¸ªè®°å½•ã€‚å¦‚æœæœªæŒ‡å®š Variable å‚æ•°ï¼Œåˆ™ $0 è®°å½•å˜é‡å’Œ NF ç‰¹æ®Šå˜é‡è®¾ç½®ä¸ºä»æµè¯»å–çš„è®°å½•ã€‚ |
| getline [ Variable ] < Expression   | ä» Expression å‚æ•°æŒ‡å®šçš„æ–‡ä»¶è¯»å–è¾“å…¥çš„ä¸‹ä¸€ä¸ªè®°å½•ï¼Œå¹¶å°† Variable å‚æ•°æŒ‡å®šçš„å˜é‡è®¾ç½®ä¸ºè¯¥è®°å½•çš„å€¼ã€‚åªè¦æµä¿ç•™æ‰“å¼€ä¸” Expression å‚æ•°å¯¹åŒä¸€ä¸ªå­—ç¬¦ä¸²æ±‚å€¼ï¼Œåˆ™å¯¹ getline å‡½æ•°çš„æ¯æ¬¡åç»­è°ƒç”¨è¯»å–å¦ä¸€ä¸ªè®°å½•ã€‚å¦‚æœæœªæŒ‡å®š Variable å‚æ•°ï¼Œåˆ™ $0 è®°å½•å˜é‡å’Œ NF ç‰¹æ®Šå˜é‡è®¾ç½®ä¸ºä»æµè¯»å–çš„è®°å½•ã€‚ |
| getline [ Variable ]                | å°† Variable å‚æ•°æŒ‡å®šçš„å˜é‡è®¾ç½®ä¸ºä»å½“å‰è¾“å…¥æ–‡ä»¶è¯»å–çš„ä¸‹ä¸€ä¸ªè¾“å…¥è®°å½•ã€‚å¦‚æœæœªæŒ‡å®š Variable å‚æ•°ï¼Œåˆ™ $0 è®°å½•å˜é‡è®¾ç½®ä¸ºè¯¥è®°å½•çš„å€¼ï¼Œè¿˜å°†è®¾ç½® NFã€NR å’Œ FNR ç‰¹æ®Šå˜é‡ã€‚ |

**æ‰“å¼€å¤–éƒ¨æ–‡ä»¶ï¼ˆcloseç”¨æ³•ï¼‰**

```shell
awk 'BEGIN{while("cat /etc/passwd"|getline){print $0;};close("/etc/passwd");}'
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
```

**é€è¡Œè¯»å–å¤–éƒ¨æ–‡ä»¶(getlineä½¿ç”¨æ–¹æ³•ï¼‰**

```shell
awk 'BEGIN{while(getline < "/etc/passwd"){print $0;};close("/etc/passwd");}'
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
awk 'BEGIN{print "Enter your name:";getline name;print name;}'
Enter your name:
chengmo
chengmo
```

**è°ƒç”¨å¤–éƒ¨åº”ç”¨ç¨‹åº(systemä½¿ç”¨æ–¹æ³•ï¼‰**

```shell
awk 'BEGIN{b=system("ls -al");print b;}'
total 42092
drwxr-xr-x 14 chengmo chengmo     4096 09-30 17:47 .
drwxr-xr-x 95 root   root       4096 10-08 14:01 ..
```

bè¿”å›å€¼ï¼Œæ˜¯æ‰§è¡Œç»“æœã€‚

### æ—¶é—´å‡½æ•°

| æ ¼å¼                               | æè¿°                                                         |
| ---------------------------------- | ------------------------------------------------------------ |
| å‡½æ•°å                             | è¯´æ˜                                                         |
| mktime( YYYY MM dd HH MM ss[ DST]) | ç”Ÿæˆæ—¶é—´æ ¼å¼                                                 |
| strftime([format [, timestamp]])   | æ ¼å¼åŒ–æ—¶é—´è¾“å‡ºï¼Œå°†æ—¶é—´æˆ³è½¬ä¸ºæ—¶é—´å­—ç¬¦ä¸²å…·ä½“æ ¼å¼ï¼Œè§ä¸‹è¡¨ã€‚     |
| systime()                          | å¾—åˆ°æ—¶é—´æˆ³ï¼Œè¿”å›ä»1970å¹´1æœˆ1æ—¥å¼€å§‹åˆ°å½“å‰æ—¶é—´(ä¸è®¡é—°å¹´)çš„æ•´ç§’æ•° |

**å»ºæŒ‡å®šæ—¶é—´(mktimeä½¿ç”¨ï¼‰**

```shell
awk 'BEGIN{tstamp=mktime("2001 01 01 12 12 12");print strftime("%c",tstamp);}'
2001å¹´01æœˆ01æ—¥ æ˜ŸæœŸä¸€ 12æ—¶12åˆ†12ç§’
awk 'BEGIN{tstamp1=mktime("2001 01 01 12 12 12");tstamp2=mktime("2001 02 01 0 0 0");print tstamp2-tstamp1;}'
2634468
```

æ±‚2ä¸ªæ—¶é—´æ®µä¸­é—´æ—¶é—´å·®ï¼Œä»‹ç»äº†strftimeä½¿ç”¨æ–¹æ³•

```shell
awk 'BEGIN{tstamp1=mktime("2001 01 01 12 12 12");tstamp2=systime();print tstamp2-tstamp1;}' 
308201392
```

**strftimeæ—¥æœŸå’Œæ—¶é—´æ ¼å¼è¯´æ˜ç¬¦**

| æ ¼å¼ | æè¿°                                                     |
| ---- | -------------------------------------------------------- |
| %a   | æ˜ŸæœŸå‡ çš„ç¼©å†™(Sun)                                        |
| %A   | æ˜ŸæœŸå‡ çš„å®Œæ•´å†™æ³•(Sunday)                                 |
| %b   | æœˆåçš„ç¼©å†™(Oct)                                          |
| %B   | æœˆåçš„å®Œæ•´å†™æ³•(October)                                  |
| %c   | æœ¬åœ°æ—¥æœŸå’Œæ—¶é—´                                           |
| %d   | åè¿›åˆ¶æ—¥æœŸ                                               |
| %D   | æ—¥æœŸ 08/20/99                                            |
| %e   | æ—¥æœŸï¼Œå¦‚æœåªæœ‰ä¸€ä½ä¼šè¡¥ä¸Šä¸€ä¸ªç©ºæ ¼                         |
| %H   | ç”¨åè¿›åˆ¶è¡¨ç¤º24å°æ—¶æ ¼å¼çš„å°æ—¶                             |
| %I   | ç”¨åè¿›åˆ¶è¡¨ç¤º12å°æ—¶æ ¼å¼çš„å°æ—¶                             |
| %j   | ä»1æœˆ1æ—¥èµ·ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©                                 |
| %m   | åè¿›åˆ¶è¡¨ç¤ºçš„æœˆä»½                                         |
| %M   | åè¿›åˆ¶è¡¨ç¤ºçš„åˆ†é’Ÿ                                         |
| %p   | 12å°æ—¶è¡¨ç¤ºæ³•(AM/PM)                                      |
| %S   | åè¿›åˆ¶è¡¨ç¤ºçš„ç§’                                           |
| %U   | åè¿›åˆ¶è¡¨ç¤ºçš„ä¸€å¹´ä¸­çš„ç¬¬å‡ ä¸ªæ˜ŸæœŸ(æ˜ŸæœŸå¤©ä½œä¸ºä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹) |
| %w   | åè¿›åˆ¶è¡¨ç¤ºçš„æ˜ŸæœŸå‡ (æ˜ŸæœŸå¤©æ˜¯0)                            |
| %W   | åè¿›åˆ¶è¡¨ç¤ºçš„ä¸€å¹´ä¸­çš„ç¬¬å‡ ä¸ªæ˜ŸæœŸ(æ˜ŸæœŸä¸€ä½œä¸ºä¸€ä¸ªæ˜ŸæœŸçš„å¼€å§‹) |
| %x   | é‡æ–°è®¾ç½®æœ¬åœ°æ—¥æœŸ(08/20/99)                               |
| %X   | é‡æ–°è®¾ç½®æœ¬åœ°æ—¶é—´(12:00:00)                               |
| %y   | ä¸¤ä½æ•°å­—è¡¨ç¤ºçš„å¹´(99)                                     |
| %Y   | å½“å‰æœˆä»½                                                 |
| %%   | ç™¾åˆ†å·(%)                                                |

æœªæ¥å¯èƒ½å¦åšè¡¥å……

## Reference

[Linux å‘½ä»¤è¯¦è§£](https://wangchujiang.com/linux-command/c/awk.html)
